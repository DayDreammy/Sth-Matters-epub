# Context Engineering Protocol (DevDocs)

**Core Directive:** 你必须维护一套“外部工作记忆系统”，以克服长对话中的上下文丢失 (Context Loss)。不要依赖隐式的对话历史，而要依赖显式的文档记录。

你的工作流必须围绕以下三个核心文档（DevDocs Trinity）展开。如果当前目录下不存在这些文件，请在项目启动时建议我创建，或直接根据当前任务初始化它们。

## 1. 文档体系定义

### 🧭 `plan.md` (战略层 - The Map)
*   **作用**：定义项目的最终目标、当前所处的阶段以及**不做的一件事（Anti-Goals）**。
*   **你的行为准则**：
    *   在接受新任务前，检查此文件以确认并未偏离航向（防止 Scope Creep）。
    *   如果我让你做的事与当前阶段冲突，请提醒我更新此文件。

### 🧠 `context.md` (知识层 - The Brain)
*   **作用**：记录**已确认的**事实、物理常数、核心技术决策和“经验教训”。这是你的长期记忆。
*   **你的行为准则**：
    *   **启动必读**：每次会话开始时，必须优先读取此文件以“对齐认知”。
    *   **动态更新**：每当我们在对话中确认了一个关键结论（例如：“简单增益无效，必须用高频合成”），立即将此结论写入文件。不要让宝贵的知识淹没在聊天记录中。

### ✅ `tasks.md` (执行层 - The Tracker)
*   **作用**：当前具体的任务列表和进度状态。
*   **你的行为准则**：
    *   每完成一个步骤，主动勾选更新。
    *   保持任务粒度适中，作为我们工作的“心跳”。

---

## 2. 交互触发器 (Triggers)

*   **[初始化]**：如果项目刚开始，请输出下面的 **Initial Templates** 并询问我是否创建。
*   **[迷失]**：如果你感到困惑，或者生成的代码逻辑前后不一致，请停止编码，读取 `context.md` 并向我复述当前的核心约束。
*   **[变更]**：如果我改变了需求，请先更新 `plan.md`，再写代码。

---

## 3. Templates (文档模板)

如果需要创建文件，请使用以下标准模板：

### 📄 Template: `plan.md`

```markdown
# Project Plan: [Project Name]

## 🎯 Goal (核心目标)
简短描述项目要解决的核心业务问题（而非仅仅是工程问题）。
例如：构建一个能让听感真实的齿音增强系统，而非“写一个Python脚本”。

## 📍 Current Phase (当前阶段)
- [ ] **Phase 1: 探索与验证 (MVP)**
    - 重点：核心算法验证，可视化确认。
    - 严禁：过度工程化，优化UI。
- [ ] **Phase 2: 工程化实现**
    - 重点：代码结构重构，批量处理。
- [ ] **Phase 3: 交付与验收**
    - 重点：文档，测试报告。

## 🚫 Out of Scope (本阶段不做的事)
- 明确列出任何可能导致分心的任务（例如：编写图形化界面、支持多语言等）。
```

### 📄 Template: `context.md`

```markdown
# Project Context & Knowledge Base

## 🧠 Core Concepts (核心概念与对齐)
> 在此记录项目涉及的领域知识，防止 AI "幻觉"。
- **物理常数**: (例如：目标频段 7k-10kHz)
- **算法原理**: (例如：高频噪声注入 High Frequency Noise Injection)
- **关键术语**: (例如：Sibilance, Spectrogram)

## 🏗 Architecture Decisions (架构决策)
> 记录"为什么这么做"，防止反复修改已定方案。
- **库的选择**: 使用 `librosa` 因为它的音频处理功能最全；不使用 `pydub` 因为它处理 numpy 数组不便。
- **文件结构**: 核心逻辑锁定在 `core.py`，业务逻辑在 `main.py`。

## 💡 Lessons Learned (已验证的结论)
> 最重要的部分。记录"什么尝试失败了"，防止重蹈覆辙。
- [YYYY-MM-DD]: 简单的 EQ 增益 (Gain) 无效，因为原始音频在该频段没有信息。
- [YYYY-MM-DD]: 必须使用对数梅尔频谱图 (Log-Mel Spectrogram) 才能看清高频细节。
```

### 📄 Template: `tasks.md`

```markdown
# Task List

## Pending
- [ ] 任务 A
- [ ] 任务 B

## In Progress
- [ ] 正在进行的任务...

## Done
- [x] 已完成的任务 (保留记录以便追溯)
```