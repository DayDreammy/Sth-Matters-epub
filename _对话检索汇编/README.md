# 对话检索汇编系统

一个基于Python的知识管理检索系统，用于从大型Markdown文档库中检索、汇编和生成多格式阅读文档。

## 系统概述

本系统旨在从结构化的知识库中高效检索特定主题的内容，并生成多种格式的阅读文档，包括：

- Markdown汇编文档
- HTML文档  
- EPUB电子书
- 主题分类文档
- 概念索引文档

## 功能特性

### 🔍 智能检索
- 基于文件名和内容的全文检索
- 支持中文关键词匹配
- 自动提取文章元数据（字数、分类、标签等）
- 智能内容分类和主题识别

### 📊 多格式输出
- **原始汇编**: 完整的原文内容汇编
- **主题分类**: 按主题分组的阅读文档
- **概念索引**: 关键概念和术语的索引
- **内容概要**: 统计信息和摘要
- **HTML版本**: 适合网页浏览的格式
- **EPUB电子书**: 适合电子阅读器的格式

### 🎯 个性化定制
- 灵活的文档组织方式
- 可选的元数据显示
- 支持多种输出模板
- 微信阅读优化

## 系统架构

```
_对话检索汇编/
├── generate_reading_doc.py    # 主要文档生成器
├── generate_epub.py          # EPUB生成器
├── generated_docs/           # 输出文档目录
│   ├── 主题_原文汇编.md       # 完整原文汇编
│   ├── 主题_thematic_文档.md  # 主题分类文档
│   ├── 主题_concepts_文档.md  # 概念索引文档
│   ├── 主题_summary_文档.md   # 内容概要
│   ├── 主题_html_文档.html    # HTML版本
│   └── 主题_*.epub           # EPUB电子书
└── README.md                 # 本文档
```

## 使用方法

### 1. 基本检索

```python
# 导入主要生成器
from generate_reading_doc import SocializationDocumentGenerator

# 创建生成器实例
generator = SocializationDocumentGenerator()

# 执行检索和文档生成
generator.generate_documents("你的主题关键词")
```

### 2. 生成EPUB

```python
# 导入EPUB生成器
from generate_epub import SocializationEPUBGenerator

# 创建EPUB生成器实例
epub_generator = SocializationEPUBGenerator()

# 生成EPUB文件
epub_generator.generate_epub("你的主题关键词")
```

### 3. 命令行使用

```bash
# 生成所有格式文档
python generate_reading_doc.py

# 生成EPUB
python generate_epub.py
```

## 输出格式说明

### 1. 原文汇编文档 (`主题_原文汇编.md`)
- 包含所有检索到的完整原文
- 按相关性排序
- 保留原始格式和链接

### 2. 主题分类文档 (`主题_thematic_文档.md`)
- 按主题分组组织内容
- 便于系统性阅读
- 包含主题间的关联

### 3. 概念索引文档 (`主题_concepts_文档.md`)
- 提取关键概念和术语
- 按字母顺序排列
- 包含概念定义和出处

### 4. 内容概要文档 (`主题_summary_文档.md`)
- 统计信息（来源数量、字数等）
- 分类统计
- 关键概念列表
- 概念关系图

### 5. HTML文档 (`主题_html_文档.html`)
- 网页友好的格式
- 包含样式和导航
- 支持超链接跳转

### 6. EPUB电子书 (`主题_*.epub`)
- 适合电子阅读器
- 包含目录和导航
- 优化阅读体验

## 配置选项

### 检索配置
```python
# 在生成器中可以配置以下选项：
config = {
    "min_word_count": 200,      # 最小字数要求
    "max_sources": 50,         # 最大来源数量
    "search_extensions": [".md"], # 搜索的文件扩展名
    "exclude_dirs": ["__pycache__"], # 排除的目录
    "content_preview_length": 200 # 内容预览长度
}
```

### 输出配置
```python
# 输出格式配置：
output_config = {
    "include_metadata": True,   # 是否包含元数据
    "include_toc": True,        # 是否包含目录
    "include_stats": True,     # 是否包含统计信息
    "format_template": "simple" # 格式模板
}
```

## 工作流程

### 步骤1: 需求分析
- 确定检索主题和关键词
- 明确输出格式需求
- 设定检索范围和参数

### 步骤2: 系统检索
- 执行多策略全文检索
- 收集相关文档和元数据
- 内容质量评估和筛选

### 步骤3: 文档生成
- 生成多种格式的汇编文档
- 自动化内容组织和分类
- 生成索引和概要信息

### 步骤4: 质量检查
- 验证内容完整性
- 检查格式一致性
- 测试输出文件可用性

## 搜索策略

### 多维度检索
1. **文件名检索**: 基于文件名和路径匹配
2. **内容检索**: 基于文件内容的全文检索
3. **标签检索**: 基于文档标签和分类
4. **语义检索**: 基于关键词语义匹配

### 相关性排序
- 关键词匹配度
- 内容相关性
- 文档质量和完整性
- 时间新鲜度

## 依赖库

```python
# 主要依赖
import os
import json
import re
from pathlib import Path
from typing import Dict, List, Any
import html
from datetime import datetime

# EPUB生成依赖
from ebooklib import epub
import markdown
```

## 🔧 工作流程详解

### 当您请求主题搜索时

#### 第一步：需求理解
当我收到您的搜索请求时，我会：
1. **分析主题关键词**：理解您搜索的核心概念和相关术语
2. **确定检索范围**：根据知识库的分类系统确定搜索范围
3. **设定输出参数**：根据您的需求调整输出格式和组织方式

#### 第二步：执行自动搜索
我会运行以下自动化脚本：

```bash
# 执行主要搜索和文档生成
python generate_reading_doc.py

# 生成EPUB电子书
python generate_epub.py
```

#### 第三步：多格式生成
系统会自动生成以下格式：

1. **完整原文汇编** (`主题_原文汇编.md`)
   - 包含所有相关文章的完整原文
   - 按相关性排序
   - 保留原始格式和超链接

2. **主题分类文档** (`主题_thematic_文档.md`)
   - 按主题分组组织内容
   - 便于系统性阅读
   - 包含主题间的逻辑关系

3. **概念索引文档** (`主题_concepts_文档.md`)
   - 提取关键概念和术语
   - 按字母顺序排列
   - 包含概念定义和出处

4. **内容概要文档** (`主题_summary_文档.md`)
   - 统计信息（来源数量、字数等）
   - 分类统计
   - 关键概念列表

5. **HTML版本** (`主题_html_文档.html`)
   - 网页友好的格式
   - 包含样式和导航
   - 支持超链接跳转

6. **EPUB电子书** (`主题_*.epub`)
   - 适合电子阅读器
   - 包含目录和导航
   - 优化阅读体验

#### 第四步：结果交付
我会为您提供：

1. **所有生成的文件**：完整的文档集合
2. **使用说明**：各格式的特点和适用场景
3. **定制选项**：根据您的反馈调整格式和组织方式

### 使用示例

#### 示例1：主题搜索
**您的请求**："请帮我搜索关于'家庭教育'的内容"

**我的操作流程**：
1. 理解"家庭教育"相关的关键词和概念
2. 执行自动搜索脚本
3. 生成所有格式的文档
4. 提供完整结果和使用说明

**输出结果**：
- `家庭教育_原文汇编.md` - 完整原文
- `家庭教育_thematic_文档.md` - 主题分类
- `家庭教育_concepts_文档.md` - 概念索引
- `家庭教育_summary_文档.md` - 内容概要
- `家庭教育_html_文档.html` - HTML版本
- `家庭教育_*.epub` - EPUB电子书

#### 示例2：特定格式需求
**您的请求**："我想要一个关于'心理学'的EPUB文件"

**我的操作流程**：
1. 执行"心理学"主题搜索
2. 重点生成EPUB格式
3. 同时生成支持文档
4. 提供EPUB使用指南

#### 示例3：定制化需求
**您的请求**："请帮我找一些关于'时间管理'的文章，只要简单的markdown格式"

**我的操作流程**：
1. 执行"时间管理"搜索
2. 生成基础markdown文档
3. 按需简化格式
4. 提供定制化结果

### 系统特点

#### 🚀 高效性
- 一次搜索，多格式输出
- 自动化处理，无需手动操作
- 快速响应，即时生成

#### 🎯 准确性
- 多维度检索策略
- 智能相关性排序
- 内容质量评估

#### 📊 全面性
- 覆盖整个知识库
- 包含相关度高的所有内容
- 提供多角度的信息组织

#### 🔧 灵活性
- 支持格式定制
- 可调整组织方式
- 满足个性化需求

## 扩展功能

### 自定义检索策略
```python
# 可以添加自定义的检索策略
def custom_search_strategy(query: str, file_path: str) -> bool:
    # 实现自定义检索逻辑
    pass
```

### 自定义输出格式
```python
# 可以添加自定义的输出格式
def custom_output_formatter(sources: List[Dict]) -> str:
    # 实现自定义格式化逻辑
    pass
```

### 插件系统
- 支持自定义检索插件
- 支持自定义输出插件
- 支持自定义后处理插件

## 性能优化

### 检索优化
- 文件索引缓存
- 增量检索
- 并行处理
- 内存优化

### 输出优化
- 流式处理
- 分批输出
- 压缩存储
- 增量更新

## 故障排除

### 常见问题

1. **检索结果为空**
   - 检查关键词是否正确
   - 确认检索路径是否正确
   - 检查文件权限

2. **生成文件格式错误**
   - 检查依赖库是否完整
   - 确认输出目录权限
   - 验证输入数据格式

3. **EPUB生成失败**
   - 检查ebooklib库安装
   - 确认内容编码格式
   - 验证图片路径

### 调试模式
```python
# 启用调试模式
generator = SocializationDocumentGenerator(debug=True)
```

## 版本历史

- **v1.0**: 基础检索和文档生成功能
- **v1.1**: 添加EPUB生成支持
- **v1.2**: 优化检索算法和输出格式
- **v1.3**: 添加主题分类和概念索引
- **v1.4**: 性能优化和错误处理

## 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 贡献指南

欢迎贡献代码和建议！请遵循以下步骤：

1. Fork本项目
2. 创建功能分支
3. 提交更改
4. 推送到分支
5. 创建Pull Request

## 联系方式

如有问题或建议，请通过以下方式联系：

- GitHub Issues
- Email: [your-email@example.com]

---

**注意**: 本系统专为中文知识管理库设计，支持中图法分类体系和中文文本处理。